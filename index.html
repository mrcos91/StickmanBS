<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Stickman Runner</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      background: linear-gradient(to bottom, #87ceeb, #ffffff);
    }
    #left, #right {
      width: 20%;
      padding: 1em;
      background-color: #f0f0f0;
    }
    #game-container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    canvas {
      border: 3px solid #000;
      background-color: #d0f0ff;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="left">
    <h2>Controles</h2>
    <ul>
      <li><strong>‚Üê ‚Üí</strong>: Mover</li>
      <li><strong>Espacio</strong>: Saltar</li>
    </ul>
    <button id="toggleMusic">üîà M√∫sica</button>
  </div>
  <div id="game-container">
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    <div id="gameOverScreen" style="display:none; text-align:center;">
      <h2>Has perdido</h2>
      <p id="finalScore"></p>
      <button onclick="startGame()">Volver a jugar</button>
    </div>
  </div>
  <div id="right">
    <h2>Info</h2>
    <p>Puntos: <span id="score">0</span></p>
  </div>
  
  <audio id="bgMusic" loop>
    <source src="https://www.bensound.com/bensound-music/bensound-epic.mp3" type="audio/mpeg">
  </audio>
  <audio id="deathSound">
    <source src="https://www.soundjay.com/button/sounds/button-10.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const bgMusic = document.getElementById("bgMusic");
    const deathSound = document.getElementById("deathSound");

    let player = { x: 50, y: 300, w: 20, h: 40, vy: 0, grounded: false };
    let gravity = 0.8;
    let platforms = [];
    let traps = [];
    let asteroids = [];
    let keys = {};
    let score = 0;
    let musicPlaying = true;
    let gameRunning = true;

    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    document.getElementById("toggleMusic").onclick = () => {
      if (musicPlaying) {
        bgMusic.pause();
        musicPlaying = false;
      } else {
        bgMusic.play();
        musicPlaying = true;
      }
    };

    function startGame() {
      document.getElementById("gameOverScreen").style.display = "none";
      player = { x: 50, y: 300, w: 20, h: 40, vy: 0, grounded: false };
      score = 0;
      platforms = [];
      traps = [];
      asteroids = [];
      gameRunning = true;
      bgMusic.play();
      loop();
    }

    function spawnPlatform() {
      const y = 300 + Math.random() * 100 - 50;
      const w = 100 + Math.random() * 50;
      const trap = Math.random() < 0.3; // 30% probabilidad de trampa
      platforms.push({ x: canvas.width, y, w, h: 10, trap });
    }

    function spawnAsteroid() {
      asteroids.push({ x: Math.random() * canvas.width, y: -20, r: 10 + Math.random() * 20, vy: 2 + Math.random() * 2 });
    }

    function loop() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Movimiento jugador
      if (keys["ArrowLeft"]) player.x -= 4;
      if (keys["ArrowRight"]) player.x += 4;
      if (keys[" "] && player.grounded) {
        player.vy = -12;
        player.grounded = false;
      }
      player.vy += gravity;
      player.y += player.vy;

      // Dibujar jugador
      ctx.fillStyle = "black";
      ctx.fillRect(player.x, player.y, player.w, player.h);

      // Dibujar plataformas y colisi√≥n
      platforms.forEach((plat, i) => {
        plat.x -= 2;
        ctx.fillStyle = plat.trap ? "red" : "brown";
        ctx.fillRect(plat.x, plat.y, plat.w, plat.h);

        // Trampas
        if (
          plat.trap &&
          player.x < plat.x + plat.w &&
          player.x + player.w > plat.x &&
          player.y + player.h > plat.y &&
          player.y < plat.y + plat.h
        ) {
          gameOver();
        }

        // Plataforma segura
        if (!plat.trap &&
          player.x + player.w > plat.x &&
          player.x < plat.x + plat.w &&
          player.y + player.h > plat.y &&
          player.y + player.h < plat.y + plat.h + 10 &&
          player.vy >= 0
        ) {
          player.y = plat.y - player.h;
          player.vy = 0;
          player.grounded = true;
        }

        // Eliminar plataformas fuera de pantalla
        if (plat.x + plat.w < 0) {
          platforms.splice(i, 1);
          score++;
        }
      });

      // Dibujar asteroides
      asteroids.forEach((ast, i) => {
        ast.y += ast.vy;
        ctx.beginPath();
        ctx.fillStyle = "gray";
        ctx.arc(ast.x, ast.y, ast.r, 0, Math.PI * 2);
        ctx.fill();

        // Colisi√≥n con jugador
        if (
          player.x < ast.x + ast.r &&
          player.x + player.w > ast.x - ast.r &&
          player.y < ast.y + ast.r &&
          player.y + player.h > ast.y - ast.r
        ) {
          gameOver();
        }

        if (ast.y > canvas.height) asteroids.splice(i, 1);
      });

      scoreDisplay.textContent = score;

      // Gravedad fuera del canvas
      if (player.y > canvas.height) gameOver();

      // Spawners
      if (Math.random() < 0.02) spawnPlatform();
      if (Math.random() < 0.01) spawnAsteroid();

      requestAnimationFrame(loop);
    }

    function gameOver() {
      deathSound.play();
      gameRunning = false;
      bgMusic.pause();
      document.getElementById("finalScore").textContent = `Puntos: ${score}`;
      document.getElementById("gameOverScreen").style.display = "block";
    }

    startGame();
  </script>
</body>
</html>
